---
import { getAllPosts } from '@libs/Post';
import Layout from '../../../layouts/ArticleLayout.astro';
import BlogPost from 'src/components/BlogPost.astro';
import { format } from 'date-fns';

export async function getStaticPaths() {
  const posts = await getAllPosts();

  return posts.map((p) => {
    return {
      params: { path: p.slug },
    };
  });
}

// Collections query
const { path } = Astro.params;
const posts = await getAllPosts();
const post = posts.find((p) => p.slug === path);

if (post == undefined) {
  throw 'Unable to load post';
}

const { Content } = await post.content.render();
const dateStr = format(post.data.date, 'Mo MMMM, yyyy');
---

<Layout article={post}>
  <aside slot="header">
    <time datetime={post.data.date.toISOString()}>{dateStr}</time>
  </aside>
  <h1>{post.data.title}</h1>
  <Content />
</Layout>
